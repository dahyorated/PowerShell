{"tasks":[{"environment":{},"displayName":"Task group: Load DevOps Scripts","alwaysRun":true,"continueOnError":true,"condition":"succeededOrFailed()","enabled":true,"timeoutInMinutes":0,"inputs":{"library.debug":""},"task":{"id":"7439f6dd-01c4-4f7a-925a-5040ecc48aa8","versionSpec":"1.*","definitionType":"metaTask"}},{"environment":{},"displayName":"Azure PowerShell script: FilePath","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"ConnectedServiceNameARM":"$(serviceConnection)","ScriptType":"FilePath","ScriptPath":"$(System.DefaultWorkingDirectory)/_IAC Scripts - CI/scripts/VSTSRMScripts/VSTSRMScripts/Get-DatabaseVariables.ps1","Inline":"# You can write your azure powershell scripts inline here. \n# You can also pass predefined and custom variables to this script using arguments","ScriptArguments":"-KeyVault $(keyvault) -DatabaseName $(dbName) -StageName $(StageName)","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":"","pwsh":"false","workingDirectory":""},"task":{"id":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","versionSpec":"4.*","definitionType":"task"}},{"environment":{},"displayName":"Perform DeployFromPackage","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"Operation":"DeployFromPackage","NuGetFile":"$(System.DefaultWorkingDirectory)/_Alert Service Databases - CI/Database Build Artifact","ExportPath":"","PackagePath":"$(packagePath)","ImportPath":"","AppendEnvironment":"true","SourceDatabaseServer":"","SourceDatabaseName":"","SourceAuthMethod":"sqlServerAuth","SourceDatabaseUsername":"","SourceDatabasePassword":"","TargetDatabaseServer":"$(dbServer)","TargetDatabaseName":"$(dbName)","TargetAuthMethod":"sqlServerAuth","TargetDatabaseUsername":"$(dbuser)","TargetDatabasePassword":"$(TargetPassword)","DeleteFilesInExportFolder":"true","IgnoreStaticData":"false","SqlCompareOptions":"","SqlDataCompareOptions":"","QueryBatchTimeout":"","FilterPath":"$(filterPath)","TransactionIsolationLevel":"serializable","AbortOnWarning":"none","SkipPostUpdateSchemaCheck":"false","requiredVersionOfDlma":"latest","requiredVersion":""},"task":{"id":"c1177c17-3934-4005-ba89-a4549fe4f0a1","versionSpec":"3.*","definitionType":"task"}},{"environment":{},"displayName":"Azure PowerShell script: Update Tenant DB Ids for Client DB","alwaysRun":false,"continueOnError":false,"condition":"and(succeeded(), eq(variables['dbName'], 'clientdb'))","enabled":true,"timeoutInMinutes":0,"inputs":{"ConnectedServiceNameARM":"$(serviceConnection)","ScriptType":"FilePath","ScriptPath":"$(Agent.ToolsDirectory)/scripts/Update-TenantReleaseDefinitionIds.ps1","Inline":"# You can write your azure powershell scripts inline here. \n# You can also pass predefined and custom variables to this script using arguments","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":"","pwsh":"false","workingDirectory":""},"task":{"id":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","versionSpec":"4.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":14,"createdBy":{"displayName":"Brad Friedlander","id":"23725266-5bf7-603d-b232-59edf9d07071","uniqueName":"Brad.Friedlander@ey.com"},"createdOn":"2019-12-04T13:56:46.630Z","modifiedBy":{"displayName":"Brad Friedlander","id":"23725266-5bf7-603d-b232-59edf9d07071","uniqueName":"Brad.Friedlander@ey.com"},"modifiedOn":"2020-05-06T11:45:31.887Z","comment":"Using new script and simplifying execution control.","id":"a2330dcb-64d7-41ef-ad43-3489772cf557","name":"Database Deploy from Package (CTP)","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M161_20191203.1/_content/icon-meta-task.png","friendlyName":"Database Deploy from Package (CTP)","description":"Common task group for ready roll deployments where the password is retrieved from the key vault.","category":"Deploy","definitionType":"metaTask","author":"Brad Friedlander","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"dbName","label":"dbName","defaultValue":"$(dbName)","required":true,"type":"string","helpMarkDown":"The name of the database","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"dbServer","label":"dbServer","defaultValue":"","required":true,"type":"string","helpMarkDown":"The fully qualified SQL Server instance name for the target database.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"dbuser","label":"dbuser","defaultValue":"","required":true,"type":"string","helpMarkDown":"The SQL Server username used to connect to the database.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"filterPath","label":"filterPath","defaultValue":"","required":true,"type":"string","helpMarkDown":"The path to a .scpf filter file. Overrides any existing Filter.scpf file present in the package/source control repository, and is used when creating the update SQL. Filter files can be generated by SQL Source Control and SQL Compare.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"keyvault","label":"keyvault","defaultValue":"$(keyvault)","required":true,"type":"string","helpMarkDown":"The key vault for the environment","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"packagePath","label":"packagePath","defaultValue":"","required":true,"type":"filePath","helpMarkDown":"Path to the SQL Change Automation build artifact that you wish to deploy from. You can use $(Build.BuildId) or $(Build.BuildNumber) variables to customize it.","groupName":""},{"aliases":[],"options":{},"properties":{"EndpointFilterRule":"ScopeLevel != AzureMLWorkspace"},"name":"serviceConnection","label":"serviceConnection","defaultValue":"$(serviceConnection)","required":true,"type":"connectedService:AzureRM","helpMarkDown":"Azure Resource Manager subscription to configure before running PowerShell","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"StageName","label":"StageName","defaultValue":"$(StageName)","required":true,"type":"string","helpMarkDown":"The name of the deployment stage","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"TargetPassword","label":"TargetPassword","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Database Deploy from Package (CTP) $(dbName)","preJobExecution":{},"execution":{},"postJobExecution":{}}