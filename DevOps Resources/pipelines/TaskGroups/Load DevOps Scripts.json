{"tasks":[{"environment":{},"displayName":"DevOps: Azure PowerShell Get Scripts","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"ConnectedServiceNameARM":"adf56392-c489-49a6-bfca-f025b36f9b2c","ScriptType":"InlineScript","ScriptPath":"","Inline":"# Source: devops\\scripts\\InlineScripts\\Get-DevOpsFromContainer.ps1\n$storageAccount = 'EUWDGTP005STA01';\n$containerName = 'devops';\n$zipFileName = 'scripts.zip';\n$destinationFolder = \"{0}\\scripts\" -f $env:AGENT_TOOLSDIRECTORY;\nWrite-Output (\"destinationFolder: {0}\" -f $destinationFolder);\n$zipFile = \"{0}\\{1}\" -f $destinationFolder,$zipFileName;\nWrite-Output (\"zipFile: {0}\" -f $zipFile);\nif (Test-Path $destinationFolder)\n{\n  Remove-Item -Path $destinationFolder -Recurse -Force;\n}\nNew-Item -ItemType \"directory\" -Path $destinationFolder;\n$storage = Get-AzStorageAccount -ResourceGroupName GT-WEU-GTP-CORE-DEV-RSG -Name $storageAccount;\n$context = $storage.Context;\n$files = Get-AzStorageBlob -Container $containerName -Context $storage.Context;\n[array]$files = Get-AzStorageBlob -Container $containerName -Context $storage.Context -Blob $zipFileName;\n$count = $files.Count;\nif ($count -eq 1)\n{\n  $fileName = $files[0].Name;\n  $file = Get-AzStorageBlobContent -Blob $fileName -Container $containerName -Destination $destinationFolder -Context $context;\n  if ($null -ne $file)\n  {\n    Write-Output \"Copied '$fileName'.\";\n    if ($env:IS_PSCX_ARCHIVE -eq $true)\n    {\n      Expand-Archive -Path $zipFile -OutputPath $destinationFolder;\n    }\n    else\n    {\n      Expand-Archive -Path $zipFile -DestinationPath $destinationFolder;\n    }\n    Write-Output \"Expanded '$fileName'.\";\n    Remove-Item -Path $zipFile -Force;\n  }\n  else\n  {\n    Write-Error \"Copy of '$fileName' failed.\";\n  }\n}\nelse\n{\n    Write-Error (\"'{0}' is missing from '{1}' container on '{2}.\" -f $zipFileName,$containerName,$storageAccount);\n}\n$ENV:PATH = \"{0};{1}\" -f $destinationFolder,$ENV:PATH;\n","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":"3.1.0","pwsh":"false","workingDirectory":""},"task":{"id":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","versionSpec":"4.*","definitionType":"task"}},{"environment":{},"displayName":"DevOps: PowerShell Diagnostics","alwaysRun":false,"continueOnError":false,"condition":"eq(variables['library.debug'], true)","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"if (\"$(library.debug)\" -eq \"true\")\n{\n    Write-Output \"Debugging Build Versioning library.\";\n}\nWrite-Output \"Content of ENV:PATH\";\n$ENV:PATH -split \";\" | Foreach-Object { Write-Output $_ };\nWrite-Output \"Content of `$(Agent.ToolsDirectory)/scripts\";\nGet-ChildItem $(Agent.ToolsDirectory)/scripts;\n","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":3,"createdBy":{"displayName":"Brad Friedlander","id":"23725266-5bf7-603d-b232-59edf9d07071","uniqueName":"Brad.Friedlander@ey.com"},"createdOn":"2020-04-29T10:50:21.773Z","modifiedBy":{"displayName":"Brad Friedlander","id":"23725266-5bf7-603d-b232-59edf9d07071","uniqueName":"Brad.Friedlander@ey.com"},"modifiedOn":"2020-05-06T11:43:10.267Z","comment":"Updated description.","id":"7439f6dd-01c4-4f7a-925a-5040ecc48aa8","name":"Load DevOps Scripts","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M168_20200424.14/_content/icon-meta-task.png","friendlyName":"Load DevOps Scripts","description":"This task group loads the DevOps PowerShell scripts and control files into the \"$(Agent.ToolsDirectory)/scripts\" folder. The source is the 'devops' container in the 'EUWDGTP005STA01' storage account.","category":"Utility","definitionType":"metaTask","author":"Brad Friedlander","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"library.debug","label":"library.debug","defaultValue":"false","required":true,"type":"string","helpMarkDown":"Set to true to generate additional diagnostic output.","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Load DevOps Scripts $(library.debug)","preJobExecution":{},"execution":{},"postJobExecution":{}}